{"version":3,"file":"BulletJs.esm.js","sources":["../src/helper.ts","../src/core.ts"],"sourcesContent":["export const BULLETCLASS = '__bullet-item-style'\nexport const BULLETTEMPCLASS = '__bullet-temp-container'\n\n/**\n * 插入样式\n * @param {*} width\n */\nexport const initBulletAnimate = (width: number): void => {\n  let style = document.createElement('style')\n  const animateClass = 'BULLET_ANIMATE'\n  style.classList.add(animateClass)\n\n  let from = `from { visibility: visible; transform: translateX(${width}px); }`\n  let to = `to { visibility: visible; transform: translateX(-100%); }`\n\n  const animateString = `@keyframes RightToLeft { ${from} ${to} }`\n\n  const bulletContainer = `\n  .${BULLETCLASS} {\n\t\tcursor: pointer;\n\t\tposition: absolute;\n\t\tleft: 0;\n\t\tanimation-name: RightToLeft;\n\t\tanimation-timing-function: linear;\n\t\toverflow: hidden;\n\t\tdisplay: inline-block;\n\t\tword-break: keep-all;\n\t\twhite-space: nowrap;\n\t}`\n\n  const bulletTempContainer = `\n\t.${BULLETTEMPCLASS} {\n\t\tposition: absolute;\n\t\tright: 9999px;\n\t\tvisibility: hidden;\n\t}`\n\n  style.innerHTML = animateString + bulletContainer + bulletTempContainer\n  document.head.appendChild(style)\n}\n\n/**\n * 获取弹幕item\n * @param {*} opts\n */\n\nexport type ItrackObj = {\n  speed: number\n  // 后续可能还会增加其他属性，先以对象表示\n}\n\nexport interface IoptsType {\n  trackHeight?: number\n  trackArr?: ItrackObj[]\n  pauseOnHover?: boolean\n  pauseOnClick?: boolean\n  onStart?: Function | null\n  onEnd?: Function | null\n  duration?: string\n  speed?: number\n}\n\n// 创建单条弹幕的容器\nexport const getContainer = (): HTMLElement => {\n  const bulletContainer = document.createElement('div')\n  bulletContainer.id = Math.random().toString(36).substring(2)\n  bulletContainer.classList.add(BULLETCLASS)\n  return bulletContainer\n}\n\n/**\n * 获取 [min, max] 的随机数\n * @param {*} min\n * @param {*} max\n */\nexport const getRandom = (min: number, max: number): number =>\n  parseInt((Math.random() * (max - min + 1)) as any) + min\n\n/**\n * 事件委托\n * @param {*} target 绑定事件的元素\n * @param {*} className 需要执行绑定事件的元素的 class\n * @param {*} cb 执行的回调\n */\nexport function eventEntrust(\n  target: HTMLElement,\n  event: 'click' | 'mouseover' | 'mouseout' | 'mousemove',\n  className: string,\n  cb: (el: HTMLElement) => void,\n) {\n  target.addEventListener(event, e => {\n    let el = e.target as HTMLElement\n\n    // 判断当前点击的元素是否为指定的classname，如果不是，执行以下的while循环\n    while (!el.className.includes(className)) {\n      // 如果点击的元素为target，直接跳出循环（代表未找到目标元素）\n      if (el === target) {\n        el = null\n        break\n      }\n      //否则，将当前元素父元素赋给el\n      // console.log('whild循环中...')\n      el = el.parentNode as HTMLElement\n    }\n    if (el) {\n      // console.log('找到目标元素')\n      cb(el)\n    } else {\n      // console.log('你触发的不是目标元素')\n    }\n  })\n}\n","import {\n  initBulletAnimate,\n  getContainer,\n  getRandom,\n  eventEntrust,\n  IoptsType,\n  BULLETCLASS,\n  BULLETTEMPCLASS,\n} from './helper'\n\n// 基础配置\nconst defaultOptions = {\n  trackHeight: 50, // 跑道高度\n  pauseOnHover: false,\n  pauseOnClick: false,\n  onStart: null,\n  onEnd: null,\n  duration: '10s',\n  trackArr: [{ speed: 150 }, { speed: 130 }],\n  speed: 100, // 100px/s\n}\n\ntype ItrackStatus = 'running' | 'idle'\ntype IBulletInfo = {\n  width: number\n}\n\n// 用户自己发送的弹幕，多增加一个 item(html 字符串) 作为用户 push 的内容\ntype IQueue = { item: string; opts: IoptsType }\n\nexport class BulletJs {\n  ele: string | HTMLElement\n  options: IoptsType\n  targetPos: DOMRect\n\n  target: HTMLElement = null\n  tempContanier: HTMLElement = null // 临时弹幕容器\n  bulletInfo: IBulletInfo = { width: 0 } // 当前push的弹幕对象信息\n  bullets: HTMLElement[][] = [] // 弹幕存储器 ==> 各跑道内所对应的弹幕\n  tracks: ItrackStatus[] = [] // 轨道列表\n  queues: IQueue[] = [] // 用户自己发送的的弹幕存储列表\n  targetW: number = 0 // 舞台宽度\n  pauseArrs: HTMLElement[] = [] // 暂停队列\n  isAllPaused: boolean = false // 是否全部暂停\n  constructor(ele: string | HTMLElement, opts: IoptsType = {}) {\n    this.options = Object.assign(defaultOptions, opts)\n    this.ele = ele\n    // 初始化舞台\n    this.initScreen()\n    // 初始化全局参数\n    this.initOpt()\n    // 初始化临时弹幕容器\n    this.initTempContainer()\n    this._addExtraEvent()\n  }\n\n  // 设置弹幕目标\n  private initScreen() {\n    if (typeof this.ele === 'string') {\n      this.target = document.querySelector(this.ele)\n      if (!this.target) throw new Error('The display target does not exist')\n    } else if (this.ele instanceof HTMLElement) {\n      this.target = this.ele\n    } else {\n      throw new Error('The display target of the barrage must be set')\n    }\n  }\n\n  // 初始化配置\n  private initOpt() {\n    const { trackHeight } = this.options\n    this.targetPos = this.target.getBoundingClientRect()\n    const trackNum = Math.floor(this.targetPos.height / trackHeight)\n    this.tracks = new Array(trackNum).fill('idle')\n    this.bullets = new Array(trackNum).fill([])\n    this.targetW = this.targetPos.width\n\n    // 屏幕目标必须具备的CSS样式\n    const { position } = getComputedStyle(this.target)\n    if (position === 'static') {\n      this.target.style.position = 'relative'\n      this.target.style.overflow = 'hidden'\n    }\n    // 插入css animation\n    initBulletAnimate(this.targetW)\n  }\n\n  // 初始化一个弹幕临时容器，为后期获取高度\n  private initTempContainer() {\n    this.tempContanier = document.createElement('div')\n    this.tempContanier.classList.add(BULLETTEMPCLASS)\n    document.body.appendChild(this.tempContanier)\n  }\n\n  // push 可针对具体一条弹幕设置特殊配置\n  public push(item: string, opts = {}, isSelf = false): number | string {\n    if (this.isAllPaused) return;\n    \n    const options = Object.assign({}, this.options, opts);\n    const canIndex = this._getTrackIndex();\n    \n    if (canIndex === -1) {\n      if (isSelf) {\n        this.queues.push({ item, opts });\n      }\n      return -1;\n    }\n\n    const bulletContainer = this._getBulletItem(item, options, canIndex);\n    this.bullets[canIndex] = this.bullets[canIndex].length \n      ? [...this.bullets[canIndex], bulletContainer]\n      : [bulletContainer];\n    \n    this._render(bulletContainer, canIndex);\n    this._addEvent(bulletContainer, canIndex, options);\n    return bulletContainer.id;\n  }\n  // 根据参数获取弹幕实体\n  private _getBulletItem(item: string, options: IoptsType, canIndex: number) {\n    const bulletContainer = getContainer()\n    // 此处有极大风险会出现 xss漏洞，注意切忌一定要对用户输入进行过滤，采用 innerHTML 主要是为了方便开发者可以自定义样式\n    // 故开发者一定要对用户输入内容进行转义过滤\n    bulletContainer.innerHTML = item\n    // 为了获取当前弹幕的宽度，故必须要将其先插入到document中(为了实现 弹幕防止重叠)\n    this.tempContanier.innerHTML = ''\n    this.tempContanier.appendChild(bulletContainer)\n    this.bulletInfo = { width: bulletContainer.offsetWidth }\n\n    let duration = 0\n    const speed = options.trackArr?.[canIndex]?.speed || options.speed\n    if (speed) {\n      duration = (this.targetW + this.bulletInfo.width) / speed\n    } else {\n      duration = +options.duration.slice(0, -1)\n    }\n\n    // 将duration作为弹幕固有属性存储\n    bulletContainer.dataset.duration = duration + ''\n    // 控制速度\n    bulletContainer.style.animationDuration = duration * 1000 + 'ms'\n    // 删除临时存储弹幕容器里的弹幕\n    bulletContainer.remove()\n    return bulletContainer\n  }\n\n  // 获取空闲跑道\n  private _getTrackIndex() {\n    let readyIdxs = []\n    let index = -1\n    // 优先去 idle 状态\n    this.tracks.forEach((v, idx) => v === 'idle' && readyIdxs.push(idx))\n    if (readyIdxs.length) {\n      const random = getRandom(0, readyIdxs.length - 1)\n      index = readyIdxs[random]\n      this.tracks[index] = 'running'\n      return index\n    }\n    // 没有轨道空闲，丛上到下巡检各轨道，选出可执行弹幕轨道\n    for (let i = 0; i < this.bullets.length; i++) {\n      const len = this.bullets[i].length\n      if (len) {\n        // 取出该轨道最后一条弹幕\n        const item = this.bullets[i][len - 1]\n        if (item && this._checkTrack(item)) {\n          return i\n        }\n      }\n    }\n    return index\n  }\n\n  // 判断该条轨道是否可执行弹幕\n  private _checkTrack(item: HTMLElement): boolean {\n    // 思路来源 https://www.zhihu.com/question/370464345\n    const itemPos = item.getBoundingClientRect()\n    // 轨道中最后一个元素尚未完全进入展示区域，直接跳出\n    if (itemPos.right > this.targetPos.right) {\n      return false\n    }\n\n    // 轨道中最后一个元素已完全进去展示区域\n\n    // 速度相同，只要初始条件满足即可，不用去关系追及问题\n    if (this.options.speed || this.options.trackArr?.length) {\n      if (itemPos.right < this.targetPos.right) return true\n    } else {\n      // 不设速度，靠 duration 控制，弹幕越长速度越快\n      const duration = +item.dataset.duration\n      // 原弹幕速度\n      const v1 = (this.targetW + itemPos.width) / duration\n      /**\n       * 新弹幕\n       * s2：全程距离\n       * t2：全程时间\n       * v2：速度\n       */\n      const s2 = this.targetW + this.bulletInfo.width\n      const t2 = duration\n      const v2 = s2 / t2\n\n      if (v2 <= v1) {\n        return true\n      } else {\n        // 小学时代的追及问题：t = s / v  比较时间：t1, t2\n\n        // 原弹幕跑完剩余全程所需要的时间\n        const t1 = (itemPos.right - this.targetPos.left) / v1\n        // 新弹幕头部跑完全程所需要的时间\n        const t2 = this.targetW / v2\n        // console.log('前面的--->', t1, t2, '后面的时间', v1)\n        if (t2 < t1) {\n          return false\n        }\n      }\n    }\n    return true\n  }\n\n  // 绑定事件\n  private _addEvent(\n    bulletContainer: HTMLElement,\n    canIndex: number,\n    options: IoptsType,\n  ) {\n    const { onStart, onEnd } = options\n    // 监听弹幕开始的事件\n    bulletContainer.addEventListener('animationstart', () => {\n      if (onStart) onStart.call(window, bulletContainer.id, this)\n    })\n\n    // 监听弹幕完成的事件\n    bulletContainer.addEventListener('animationend', () => {\n      if (onEnd) onEnd.call(window, bulletContainer.id, this)\n      // 从集合中剔除已经结束的动画\n      this.bullets[canIndex] = this.bullets[canIndex].filter(\n        v => v.id !== bulletContainer.id,\n      )\n\n      if (!this.bullets[canIndex].length) {\n        this.tracks[canIndex] = 'idle'\n      }\n      bulletContainer.style.willChange = 'auto'\n      bulletContainer.remove()\n    })\n  }\n\n  // 监听点击或hover事件做一些额外的处理\n  private _addExtraEvent() {\n    if (this.options.pauseOnClick) {\n      eventEntrust(this.target, 'click', BULLETCLASS, el => {\n        let currStatus = el.style.animationPlayState\n        if (currStatus == 'paused' && el.dataset.clicked) {\n          el.dataset.clicked = ''\n          this._toggleAnimateStatus(el, 'running')\n        } else {\n          el.dataset.clicked = 'true'\n          this._toggleAnimateStatus(el, 'paused')\n        }\n      })\n    }\n\n    if (this.options.pauseOnHover) {\n      eventEntrust(this.target, 'mouseover', BULLETCLASS, el => {\n        this._toggleAnimateStatus(el, 'paused')\n      })\n\n      eventEntrust(this.target, 'mouseout', BULLETCLASS, el => {\n        this._toggleAnimateStatus(el, 'running')\n      })\n    }\n  }\n\n  private _render = (container: HTMLElement, track: number) => {\n    /**\n     * container：弹幕容器\n     * track：跑道索引\n     */\n    if (this.isAllPaused) return // 如果是全部暂停状态，停止push，停止render\n    container.dataset.track = track + ''\n    container.style.top = track * this.options.trackHeight + 'px'\n    container.style.willChange = 'transform'\n    this.target.appendChild(container)\n\n    // 检测 queues\n    if (this.queues.length) {\n      const obj = this.queues.shift()\n      // 重试\n      this.push(obj.item, obj.opts, true)\n    }\n  }\n\n  /**\n   *\n   * 额外操作 api ========================================================\n   * */\n\n  //  获取弹幕列表\n  public getBulletsList() {\n    return this.bullets.reduce((acc, cur) => [...cur, ...acc], [])\n  }\n  // 切换状态\n  private _toggleAnimateStatus = (el: HTMLElement, status = 'paused') => {\n    if (el) {\n      if (status === 'running') {\n        el.style.animationPlayState = 'running'\n        el.style.zIndex = '0'\n        el.classList.remove('bullet-item-paused')\n      } else {\n        el.style.animationPlayState = 'paused'\n        el.style.zIndex = '99999'\n        el.classList.add('bullet-item-paused')\n      }\n      return\n    }\n\n    if (this.pauseArrs.length && status == 'paused') return\n    this.pauseArrs = this.getBulletsList()\n    this.pauseArrs.forEach(item => {\n      item.style.animationPlayState = status\n    })\n    this.pauseArrs = []\n  }\n\n  // 暂停\n  public pause(el: HTMLElement = null) {\n    this._toggleAnimateStatus(el, 'paused')\n    if (el === null) {\n      this.isAllPaused = true\n    }\n  }\n  // 重新开始\n  public resume(el: HTMLElement = null) {\n    this._toggleAnimateStatus(el, 'running')\n    this.isAllPaused = false\n  }\n\n  // 在 BulletJs 类中添加以下方法\n\n  public destroy(): void {\n    try {\n      // 1. 清理所有弹幕动画\n      this.isAllPaused = true;\n      const allBullets = this.getBulletsList();\n      allBullets.forEach(bullet => {\n        // 移除动画相关的事件监听器\n        bullet.removeEventListener('animationstart', null);\n        bullet.removeEventListener('animationend', null);\n        // 移除元素\n        bullet.remove();\n      });\n\n      // 2. 清理临时容器\n      if (this.tempContanier) {\n        this.tempContanier.remove();\n        this.tempContanier = null;\n      }\n\n      // 3. 移除目标元素上的事件委托\n      if (this.options.pauseOnClick) {\n        this.target.removeEventListener('click', null);\n      }\n      if (this.options.pauseOnHover) {\n        this.target.removeEventListener('mouseover', null);\n        this.target.removeEventListener('mouseout', null);\n      }\n\n      // 4. 清理动画样式\n      const animateStyle = document.querySelector('.BULLET_ANIMATE');\n      if (animateStyle) {\n        animateStyle.remove();\n      }\n\n      // 5. 重置所有内部状态\n      this.bullets = [];\n      this.tracks = [];\n      this.queues = [];\n      this.pauseArrs = [];\n      this.bulletInfo = { width: 0 };\n      this.isAllPaused = false;\n      this.targetW = 0;\n\n      // 6. 移除目标元素的样式\n      if (this.target) {\n        this.target.style.position = '';\n        this.target.style.overflow = '';\n      }\n\n      // 7. 清空引用\n      this.target = null;\n      this.ele = null;\n      this.options = null;\n\n    } catch (error) {\n      console.error('Error while destroying BulletJs instance:', error);\n    }\n  }\n}\n"],"names":[],"mappings":"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"}